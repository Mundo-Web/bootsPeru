import{j as r}from"./DataGrid-BKdWb2kD.js";import{r as c}from"./index-TykbAVkI.js";import{c as I}from"./ReactAppend-Atrjsk56.js";import{C as J}from"./CreateReactScript-QPtQNesA.js";import{F as T,P as W,a as G}from"./ProductCard-6PPsXlYe.js";import{m as b}from"./main-jzs2GwAM.js";import{a as R}from"./arrayJoin-F1p6nII-.js";import{a as H}from"./axios-wPXW9W4H.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-T3_L0chj.js";import"./index.esm-r8Xh4ePr.js";import"./TippyButton-IdRJAjYN.js";let y=new AbortController;const K=({minPrice:d,maxPrice:u,categories:j,tags:_,attribute_values:M,id_cat:p,tag_id:m,subCatId:v})=>{const[X,A]=c.useState([]),[e,w]=c.useState({category_id:p?[p]:[],subcategory_id:v?[v]:[],"txp.tag_id":m?[m]:[]}),[f,B]=c.useState(0),[a,P]=c.useState(1),[q,C]=c.useState(!1),k=c.useRef(!1),x=c.useRef(null),[l,N]=c.useState("");c.useEffect(()=>{const i=document.createElement("script");return i.src="js/notify.extend.min.js",i.async=!0,document.body.appendChild(i),()=>{document.body.removeChild(i)}},[]);const[g,F]=c.useState(a);c.useEffect(()=>{P(1),!(g==a&&a!=1)&&(F(a),E())},[e,l]),c.useEffect(()=>{a!=g&&(F(a),E())},[a,g]);const E=async()=>{y.abort(),y=new AbortController;const i=y.signal;x.current&&x.current.cancel("Operation canceled due to new request."),x.current=H.CancelToken.source();const o=[];(e.maxPrice||e.minPrice)&&(e.maxPrice&&e.minPrice?o.push([[["precio",">=",e.minPrice],"or",[["descuento",">=",e.minPrice],"and",["descuento","<>",0]]],"and",[["precio","<=",e.maxPrice],"or",[["descuento","<=",e.maxPrice],"and",["descuento","<>",0]]]]):e.minPrice?o.push([["precio",">=",e.minPrice],"or",[["descuento",">=",e.minPrice],"and",["descuento","<>",0]]]):e.maxPrice&&o.push([["precio","<=",e.maxPrice],"or",[["descuento","<=",e.maxPrice],"and",["descuento","<>",0]]]));let h=[];if(l&&(l==="price_high"?h.push({selector:"products.preciofiltro",desc:!0}):l==="price_low"?h.push({selector:"products.preciofiltro",desc:!1}):h.push({selector:"products.created_at",desc:!0})),e["txp.tag_id"]&&e["txp.tag_id"].length>0){const s=[];e["txp.tag_id"].forEach((t,n)=>{n===0?s.push(["txp.tag_id","=",t]):s.push("or",["txp.tag_id","=",t])}),o.push(s)}for(const s in e){if(!s.startsWith("attribute-")||e[s].length===0)continue;const[,t]=s.split("-"),n=[];e[s].forEach((O,z)=>{z===0?n.push(["apv.attribute_value_id","=",O]):n.push("or",["apv.attribute_value_id","=",O])}),o.push([["a.id","=",t],"and",n])}if(e.category_id&&e.category_id.length>0)if(e.category_id.length==1)o.push(["categoria_id","=",e.category_id[0]]);else{const s=e.category_id.map(t=>["categoria_id","=",t]);o.push(R(s,"or"))}if(e.subcategory_id&&e.subcategory_id.length>0){const s=[];e.subcategory_id.forEach((t,n)=>{n===0?s.push(["subcategory_id","=",t]):s.push("or",["subcategory_id","=",t])}),o.push(s)}try{const t=await(await fetch("/api/products/paginate",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Xsrf-Token":decodeURIComponent(b.Cookies.get("XSRF-TOKEN"))},body:JSON.stringify({requireTotalCount:!0,filter:R([...o,["products.visible","=",!0]],"and"),take:12,skip:12*(a-1),searchValue:b.GET.search??null,sort:h}),signal:i})).json();if(t.status!=200)throw new Error(t.message??"OcurriÃ³ un error desconocido al obtener los productos");k.current=(t==null?void 0:t.is_proveedor)??!1,A((t==null?void 0:t.data)??[]),B((t==null?void 0:t.totalCount)??0)}catch(s){b.Notify.add({type:"danger",icon:"/images/svg/Boost.svg",title:"Error al obtener los productos",body:s.message})}},S=M.reduce((i,o)=>(i[o.attribute_id]||(i[o.attribute_id]=[]),i[o.attribute_id].push(o),i),{});return r.jsxs(r.Fragment,{children:[r.jsx("style",{}),r.jsxs("form",{className:"flex flex-col md:flex-row gap-6  mx-auto font-poppins bg-[#F1F1F1] w-full",style:{padding:"40px"},children:[r.jsx("section",{className:"hidden md:flex md:flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg h-max md:sticky top-8",children:r.jsx(T,{setFilter:w,filter:e,minPrice:d??0,maxPrice:u??0,categories:j,tags:_,attribute_values:Object.values(S),selected_category:p,tag_id:m,setPriceOrder:N,priceOrder:l})}),r.jsxs("section",{className:"flex flex-col gap-6 md:basis-9/12",children:[r.jsx("div",{className:"w-full bg-white rounded-lg font-medium flex flex-row justify-between items-center px-2 py-3",children:r.jsxs("div",{className:"flex flex-row gap-2",children:[r.jsxs("span",{className:"font-normal text-[17px] text-[#666666] ml-3",children:["Mostrando ",(a-1)*12+1," - ",a*12>f?f:a*12," de ",f," resultados"]}),r.jsx("button",{type:"button",className:"md:hidden text-[#006BF6]",onClick:()=>C(!0),children:" Mostrar Filtros"})]})}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:pr-4",children:X.map((i,o)=>r.jsx(W,{item:i,bgcolor:"bg-white",is_reseller:k.current},`product-${i.id}`))}),r.jsx("div",{className:"w-full font-medium flex flex-row justify-center items-center",children:r.jsx(G,{current:a,setCurrent:P,pages:Math.ceil(f/12)||1})})]}),q&&r.jsxs("div",{className:"fixed z-40 top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center max-h-[80vh] ",id:"modal",children:[r.jsx("div",{className:"z-50 flex items-center content-center justify-center absolute  p-4 bg-black rounded-full h-6 w-6",style:{top:"20px",right:"20px"},children:r.jsx("button",{type:"button",onClick:()=>C(!1),className:"text-white text-md ",children:"X"})}),r.jsx("div",{className:"flex flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg top-2 overflow-y-auto mt-10",style:{maxHeight:"90vh",maxWidth:"85vh"},children:r.jsx(T,{priceOrder:l,setPriceOrder:N,setFilter:w,filter:e,minPrice:d??0,maxPrice:u??0,categories:j,tags:_,attribute_values:Object.values(S),selected_category:p,tag_id:m})})]})]})]})};J((d,u)=>{I(d).render(r.jsx(K,{...u}))});
