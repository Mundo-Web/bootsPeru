var b=Object.defineProperty;var w=(r,e,t)=>e in r?b(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>(w(r,typeof e!="symbol"?e+"":e,t),t);import{r as h,R as l}from"./DataGrid-TykbAVkI.js";import{c as x}from"./ReactAppend-BTPXnSoR.js";import"./OfferForm-xx_oda-4.js";import"./TippyButton-Pa5nGqER.js";import{m as o}from"./SelectAPIFormGroup-nIO6wzPs.js";import{C}from"./CreateReactScript-PevQqOAi.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-peyf00p_.js";import"./index-VFMbf6KQ.js";import"./CreateReactScript-iObpGMbC.js";import"./axios-_sX4vCAy.js";let f=new AbortController;class v{constructor(){c(this,"path",null);c(this,"paginate",async e=>{f.abort("Nothing"),f=new AbortController;const t=f.signal;return console.log(e),await(await fetch(`/api/${this.path}/paginate`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(o.Cookies.get("XSRF-TOKEN"))},body:JSON.stringify(e),signal:t})).json()});c(this,"save",async e=>{try{const{status:t,result:a}=await o.Fetch(`/api/${this.path}`,{method:"POST",body:JSON.stringify(e)});if(!t)throw new Error((a==null?void 0:a.message)||"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:a.message,type:"success"}),a}catch(t){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),null}});c(this,"status",async({id:e,status:t})=>{try{const{status:a,result:i}=await o.Fetch(`/api/${this.path}/status`,{method:"PATCH",body:JSON.stringify({id:e,status:t})});if(!a)throw new Error((i==null?void 0:i.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:i.message,type:"success"}),!0}catch(a){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:a.message,type:"danger"}),!1}});c(this,"delete",async e=>{try{const{status:t,result:a}=await o.Fetch(`/api/${this.path}/${e}`,{method:"DELETE"});if(!t)throw new Error((a==null?void 0:a.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(t){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}})}}class E extends v{constructor(){super(...arguments);c(this,"path","admin/transactions")}}const F=({gridRef:r,rest:e,columns:t,toolBar:a,masterDetail:i,filterValue:s,exportable:n,exportableName:g,customizeCell:p=()=>{}})=>(h.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(r.current).dxDataGrid({language:"es",dataSource:{load:async d=>await e.paginate({...d,_token:$('[name="csrf_token"]').attr("content")})},onToolbarPreparing:d=>{const{items:m}=d.toolbarOptions;a(m)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:s,export:{enabled:n},onExporting:function(d){var m=new ExcelJS.Workbook,y=m.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:y,component:d.component,customizeCell:function(u){p(u),u.excelCell.alignment={horizontal:"left",vertical:"top",...u.excelCell.alignment}}}).then(function(){m.xlsx.writeBuffer().then(function(u){saveAs(new Blob([u],{type:"application/octet-stream"}),`${g}.xlsx`)})})},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:10},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:t,masterDetail:i,onContentReady:(...d)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),l.createElement("div",{ref:r})),T=({title:r,gridRef:e,rest:t,columns:a,toolBar:i,masterDetail:s,filterValue:n=[],exportable:g=!1,customizeCell:p})=>l.createElement("div",{className:"flex flex-wrap"},l.createElement("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8 max-w-9xl mx-auto"},l.createElement("div",{className:"bg-white rounded-lg shadow-md"},l.createElement("div",{className:"p-4"},l.createElement("h4",{className:"text-lg font-semibold mb-4"},l.createElement("div",{id:"header-title-options",className:"float-right"}),l.createElement("span",{id:"header-title-prefix"})," Lista de ",r," ",l.createElement("span",{id:"header-title-suffix"})),l.createElement(F,{exportableName:r,gridRef:e,rest:t,columns:a.filter(Boolean),toolBar:i,masterDetail:s,filterValue:n,exportable:g,customizeCell:p}))))),N=(r,e)=>{const t=document.createElement("div");r.append(t),x(t).render(e)},R=r=>(new DOMParser().parseFromString(r,"text/html").body.textContent||"").trim(),S=({className:r,title:e,icon:t,onClick:a,...i})=>$("<div>").dxButton({hint:e,template:(s,n)=>{n.addClass(`${t} d-block`)},elementAttr:{class:`${r} position-relative me-1 px-1 py-0 tippy-here`,...i},onClick:a}),k=new E,O=()=>{const r=h.useRef();return l.createElement(l.Fragment,null,l.createElement(T,{gridRef:r,title:"Movimientos",rest:k,exportable:!0,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"sale.code",caption:"Codigo"},{dataField:"sale.status.name",caption:"Estado"},{dataField:"sale.name",caption:"Nombre",cellTemplate:(e,{data:t})=>{e.html(`${t.sale.name}<br>${t.sale.lastname||""}`.trim())}},{dataField:"sale.address_district",caption:"Distrito",cellTemplate:(e,{data:t})=>{e.html(t.sale.address_district||"<i>- Sin distrito -</i>")}},{dataField:"category",caption:"Categoria"},{dataField:"image",caption:"Imagen",width:"90px",cellTemplate:(e,{data:t})=>{N(e,l.createElement("img",{src:`/${t.product_image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:a=>a.target.src="/images/img/noimagen.jpg"}))},allowExporting:!1},{dataField:"product_name",caption:"Producto",cellTemplate:(e,{data:t})=>{e.html(t.product_name)}},{dataField:"quantity",caption:"#",dataType:"number"},{dataField:"price",caption:"Precio",dataType:"number",cellTemplate:(e,{data:t})=>{e.text(`S/.${Number(t.price).toFixed(2)}`)}},{dataField:"sale.created_at",caption:"Fecha",dataType:"datetime",format:"yyyy-MM-dd HH:mm:ss"},{caption:"Acciones",cellTemplate:(e,{data:t})=>{e.append(S({className:"px-2 py-0 text-xs font-medium text-blue-700 bg-blue-100 rounded hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out border-none text-blue-500",title:"Ver venta",icon:"fa fa-eye",onClick:()=>location.href="/admin/"}))},allowFiltering:!1,allowExporting:!1}],customizeCell:e=>{var t,a,i,s,n;((t=e==null?void 0:e.gridCell)==null?void 0:t.rowType)=="data"&&!((a=e==null?void 0:e.gridCell)!=null&&a.value)?e.gridCell.column.dataField==="sale.address_district"&&(e.excelCell.value="- Sin distrito -",e.excelCell.font={italic:!0}):((i=e==null?void 0:e.gridCell)==null?void 0:i.rowType)=="data"&&e.gridCell.column.dataField==="product_name"?(e.excelCell.value=R(e.excelCell.value.replaceAll("</b><ul",`</b>
<ul`).replaceAll("</li><li",`</li>
<li`)),e.excelCell.alignment={wrapText:!0}):((s=e==null?void 0:e.gridCell)==null?void 0:s.rowType)=="data"&&e.gridCell.column.dataField==="price"?(e.excelCell.numFmt="0.00",e.excelCell.alignment={horizontal:"right"}):((n=e==null?void 0:e.gridCell)==null?void 0:n.rowType)=="data"&&e.gridCell.column.dataField==="sale.name"&&(e.excelCell.value=`${e.gridCell.data.sale.name} ${e.gridCell.data.sale.lastname}`)}}))};C((r,e)=>{x(r).render(l.createElement(O,{...e}))});
