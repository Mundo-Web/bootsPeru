import{R as a,r as i}from"./DataGrid-TykbAVkI.js";import{c as z}from"./ReactAppend-BTPXnSoR.js";import{C as I}from"./CreateReactScript-my1HhmNP.js";import{F as R,P as J,a as U}from"./ProductCard-Z0krrd6s.js";import{m as g}from"./FilterContainer-nIO6wzPs.js";import{a as W}from"./arrayJoin-QZyv0n10.js";import{a as O}from"./axios-wPXW9W4H.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-peyf00p_.js";import"./CreateReactScript-d0ApP_b3.js";import"./TippyButton-Pa5nGqER.js";const G=({minPrice:m,maxPrice:p,categories:b,tags:y,attribute_values:T,id_cat:u,tag_id:E,subCatId:_})=>{const[j,M]=i.useState([]),[e,d]=i.useState({}),[f,X]=i.useState(0),[c,P]=i.useState(1),[q,v]=i.useState(!1),w=i.useRef(!1),h=i.useRef(null),[l,k]=i.useState("");i.useEffect(()=>{const o=new URLSearchParams(window.location.search).get("tag");o&&d(t=>({...t,"txp.tag_id":[o]})),u&&d(t=>({...t,category_id:[u]}))},[u]);const[x,C]=i.useState(c);i.useEffect(()=>{P(1),!(x==c&&c!=1)&&(C(c),F())},[e,l]),i.useEffect(()=>{c!=x&&(C(c),F())},[c,x]),i.useEffect(()=>{_!==null&&d({...e,subcategory_id:[_]})},[]);const F=async()=>{h.current&&h.current.cancel("Operation canceled due to new request."),h.current=O.CancelToken.source();const s=[];(e.maxPrice||e.minPrice)&&(e.maxPrice&&e.minPrice?s.push([[["precio",">=",e.minPrice],"or",[["descuento",">=",e.minPrice],"and",["descuento","<>",0]]],"and",[["precio","<=",e.maxPrice],"or",[["descuento","<=",e.maxPrice],"and",["descuento","<>",0]]]]):e.minPrice?s.push([["precio",">=",e.minPrice],"or",[["descuento",">=",e.minPrice],"and",["descuento","<>",0]]]):e.maxPrice&&s.push([["precio","<=",e.maxPrice],"or",[["descuento","<=",e.maxPrice],"and",["descuento","<>",0]]]));let o=[];if(l&&(l==="price_high"?o.push({selector:"products.preciofiltro",desc:!0}):l==="price_low"?o.push({selector:"products.preciofiltro",desc:!1}):o.push({selector:"products.created_at",desc:!0})),e["txp.tag_id"]&&e["txp.tag_id"].length>0){const t=[];e["txp.tag_id"].forEach((r,n)=>{n===0?t.push(["txp.tag_id","=",r]):t.push("or",["txp.tag_id","=",r])}),s.push(t)}for(const t in e){if(!t.startsWith("attribute-")||e[t].length===0)continue;const[,r]=t.split("-"),n=[];e[t].forEach((S,B)=>{B===0?n.push(["apv.attribute_value_id","=",S]):n.push("or",["apv.attribute_value_id","=",S])}),s.push([["a.id","=",r],"and",n])}if(e.category_id&&e.category_id.length>0){const t=[];e.category_id.forEach((r,n)=>{n===0?t.push(["categoria_id","=",r]):t.push("or",["categoria_id","=",r])}),s.push(t)}if(e.subcategory_id&&e.subcategory_id.length>0){const t=[];e.subcategory_id.forEach((r,n)=>{n===0?t.push(["subcategory_id","=",r]):t.push("or",["subcategory_id","=",r])}),s.push(t)}try{const{status:t,result:r}=await g.Fetch("/api/products/paginate",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(g.Cookies.get("XSRF-TOKEN"))},body:JSON.stringify({requireTotalCount:!0,filter:W([...s,["products.visible","=",!0]],"and"),take:12,skip:12*(c-1),searchValue:g.GET.search??null,sort:o})});if(!t)throw new Error((r==null?void 0:r.message)??"OcurriÃ³ un error desconocido al obtener los productos");w.current=(r==null?void 0:r.is_proveedor)??!1,M((r==null?void 0:r.data)??[]),X((r==null?void 0:r.totalCount)??0)}catch(t){O.isCancel(t)?console.log("Request canceled",t.message):console.error(t),g.Notify.add({type:"danger",icon:"/images/svg/Boost.svg",title:"Error al obtener los productos",body:t.message})}},N=T.reduce((s,o)=>(s[o.attribute_id]||(s[o.attribute_id]=[]),s[o.attribute_id].push(o),s),{});return a.createElement(a.Fragment,null,a.createElement("style",null),a.createElement("form",{className:"flex flex-col md:flex-row gap-6  mx-auto font-poppins bg-[#F1F1F1] w-full",style:{padding:"40px"}},a.createElement("section",{className:"hidden md:flex md:flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg h-max md:sticky top-2"},a.createElement(R,{setFilter:d,filter:e,minPrice:m??0,maxPrice:p??0,categories:b,tags:y,attribute_values:Object.values(N),selected_category:u,tag_id:E,setPriceOrder:k,priceOrder:l})),a.createElement("section",{className:"flex flex-col gap-6 md:basis-9/12"},a.createElement("div",{className:"w-full bg-white rounded-lg font-medium flex flex-row justify-between items-center px-2 py-3"},a.createElement("div",{className:"flex flex-row gap-2"},a.createElement("span",{className:"font-normal text-[17px] text-[#666666] ml-3"},"Mostrando ",(c-1)*12+1," - ",c*12>f?f:c*12," de ",f," resultados"),a.createElement("button",{type:"button",className:"md:hidden text-[#006BF6]",onClick:()=>v(!0)}," Mostrar Filtros"))),a.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:pr-4"},j.map((s,o)=>a.createElement(J,{key:`product-${s.id}`,item:s,bgcolor:"bg-white",is_reseller:w.current}))),a.createElement("div",{className:"w-full font-medium flex flex-row justify-center items-center"},a.createElement(U,{current:c,setCurrent:P,pages:Math.ceil(f/12)||1}))),q&&a.createElement("div",{className:"fixed z-40 top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center max-h-[80vh] ",id:"modal"},a.createElement("div",{className:"z-50 flex items-center content-center justify-center absolute  p-4 bg-black rounded-full h-6 w-6",style:{top:"20px",right:"20px"}},a.createElement("button",{type:"button",onClick:()=>v(!1),className:"text-white text-md "},"X")),a.createElement("div",{className:"flex flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg top-2 overflow-y-auto mt-10",style:{maxHeight:"90vh",maxWidth:"85vh"}},a.createElement(R,{priceOrder:l,setPriceOrder:k,setFilter:d,filter:e,minPrice:m??0,maxPrice:p??0,categories:b,tags:y,attribute_values:Object.values(N),selected_category:u,tag_id:E})))))};I((m,p)=>{z(m).render(a.createElement(G,{...p}))});
